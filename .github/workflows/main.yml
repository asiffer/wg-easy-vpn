# This is a basic workflow to help you get started with Actions

name: Build

on:
  repository_dispatch:
    types: update


# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    # Environment variables
    env:
      PACKAGES: software-properties-common byacc flex dpkg-dev debhelper crossbuild-essential-armel crossbuild-essential-armhf crossbuild-essential-arm64
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    
    - name: Set up Go 1.14
      uses: actions/setup-go@v1
      with:
        go-version: 1.14
      id: go

    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - name: Check out code into the Go module directory
      uses: actions/checkout@v1

    - name: Update 
      run: |
        sudo apt-get update
        sudo apt-get install -y $PACKAGES
        sudo apt-get upgrade -y
        sudo apt-get autoremove -y
      
    - name: Binaries
      run: |
        make GOARCH=amd64
        make GOARCH=arm64
        make GOARCH=arm GOARM=7
    
    - name: Debian
      run: |
        make debian GOARCH=amd64
        make debian GOARCH=arm64
        make debian GOARCH=arm GOARM=7
